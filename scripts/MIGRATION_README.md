# üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –≤ –ø—Ä–æ–¥–∞–∫—à–Ω:
- `analyte_categories` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–Ω–∞–ª–∏–∑–æ–≤
- `analyte_standards` - –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤
- `analyte_synonyms` - —Å–∏–Ω–æ–Ω–∏–º—ã –Ω–∞–∑–≤–∞–Ω–∏–π –∞–Ω–∞–ª–∏–∑–æ–≤

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. Python 3.7+
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
   - `asyncpg`
   - `python-dotenv`
3. SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É (–∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
4. –§–∞–π–ª—ã `.env.local` –∏ `.env.production` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ë–î

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
./scripts/migrate-to-production.sh
```

–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
python3 ./scripts/migrate-analyte-tables-ssh.py
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç SSH —Ç—É–Ω–Ω–µ–ª—å –¥–æ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø—Ä–æ–¥–∞–∫—à–Ω —Ç–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ
4. ‚úÖ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
5. ‚úÖ –ú–∏–≥—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º UUID –∏ —Å–≤—è–∑–µ–π
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
7. ‚úÖ –ó–∞–∫—Ä—ã–≤–∞–µ—Ç SSH —Ç—É–Ω–Ω–µ–ª—å

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ùå –°–∫—Ä–∏–ø—Ç **–ù–ï –º–∏–≥—Ä–∏—Ä—É–µ—Ç** –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –ø—Ä–æ–¥–∞–∫—à–Ω —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –ø—É—Å—Ç—ã–µ
- ‚ö†Ô∏è –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSH —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Ç–∞–±–ª–∏—Ü (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
ssh yc-user@158.160.99.232 'docker exec -it medhistory-postgres-1 psql -U medhistory_user -d medhistory'

# –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã (CASCADE —É–¥–∞–ª–∏—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏)
TRUNCATE TABLE analyte_synonyms CASCADE;
TRUNCATE TABLE analyte_standards CASCADE;
TRUNCATE TABLE analyte_categories CASCADE;
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
docker exec -it medhistory-postgres-1 psql -U medhistory_user -d medhistory -c "SELECT COUNT(*) FROM analyte_categories;"

# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
ssh yc-user@158.160.99.232 'docker exec medhistory-postgres-1 psql -U medhistory_user -d medhistory -c "SELECT COUNT(*) FROM analyte_categories;"'
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

- `migrate-to-production.sh` - bash-–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- `migrate-analyte-tables-ssh.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ SSH
- `migrate-analyte-tables.py` - —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è

### .env.local (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)
```bash
POSTGRES_DB=medhistory
POSTGRES_USER=your_user
POSTGRES_PASSWORD=your_password
POSTGRES_HOST=localhost  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é localhost
POSTGRES_PORT=5432       # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5432
```

### .env.production (–ø—Ä–æ–¥–∞–∫—à–Ω –ë–î)
```bash
POSTGRES_DB=medhistory
POSTGRES_USER=medhistory_user
POSTGRES_PASSWORD=your_prod_password
POSTGRES_PORT=5432
# POSTGRES_HOST –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å
```

## Troubleshooting

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL –∑–∞–ø—É—â–µ–Ω:
```bash
docker ps | grep postgres
```

### –û—à–∏–±–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø:
```bash
ssh yc-user@158.160.99.232 echo "OK"
```

### –¢–∞–±–ª–∏—Ü—ã –Ω–µ –ø—É—Å—Ç—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

–ï—Å–ª–∏ –≤—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –æ—á–∏—Å—Ç–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤—Ä—É—á–Ω—É—é (—Å–º. –≤—ã—à–µ).

### Timeout –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

–£–≤–µ–ª–∏—á—å—Ç–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ —Å–∫—Ä–∏–ø—Ç–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SSH —Ç—É–Ω–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
ssh -L 15432:localhost:5432 yc-user@158.160.99.232 -N
# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
psql -h localhost -p 15432 -U medhistory_user -d medhistory
```

## –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –≤—ã –º–æ–∂–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω (—Å–º. –≤—ã—à–µ) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ.

---

**–°–æ–∑–¥–∞–Ω–æ:** 15 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0
