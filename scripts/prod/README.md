# üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω —Å–∫—Ä–∏–ø—Ç—ã

–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–æ–º –≤ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–µ.

---

## üìã –°–∫—Ä–∏–ø—Ç—ã

### `deploy.sh` - –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π

–ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./scripts/prod/deploy.sh [SERVER_IP] [USER]
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
2. –°–æ–∑–¥–∞–µ—Ç –∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞
3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
4. –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
5. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
6. –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
7. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ Docker –æ–±—Ä–∞–∑—ã
8. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
9. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 –º–∏–Ω—É—Ç

---

### `update-backend.sh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Backend

–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ backend —Å–µ—Ä–≤–∏—Å–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./scripts/prod/update-backend.sh [SERVER_IP] [USER]
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã backend —á–µ—Ä–µ–∑ rsync
2. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç backend –æ–±—Ä–∞–∑
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health endpoint

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1-2 –º–∏–Ω—É—Ç—ã

---

### `update-frontend.sh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend

–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ frontend —Å–µ—Ä–≤–∏—Å–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./scripts/prod/update-frontend.sh [SERVER_IP] [USER]
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ (npm run build)
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã frontend —á–µ—Ä–µ–∑ rsync
3. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç frontend –æ–±—Ä–∞–∑
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1-2 –º–∏–Ω—É—Ç—ã

---

### `update-all.sh` - –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (backend + frontend + nginx).

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./scripts/prod/update-all.sh [SERVER_IP] [USER]
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã
3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
4. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –æ–±—Ä–∞–∑—ã
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
6. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3-5 –º–∏–Ω—É—Ç

---

### `diagnose.sh` - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./scripts/prod/diagnose.sh [SERVER_IP] [USER]
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
1. –õ–æ–≥–∏ backend
2. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. PostgreSQL (—Ç–∞–±–ª–∏—Ü—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
5. –¢–µ—Å—Ç API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä—è–º—É—é –∏ —á–µ—Ä–µ–∑ nginx)
6. Nginx –ª–æ–≥–∏
7. CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
8. .env —Ñ–∞–π–ª—ã

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `../config.sh`:

```bash
PROD_SERVER_IP="46.21.244.23"
PROD_SERVER_USER="yc-user"
REMOTE_PROJECT_DIR="~/medhistory"
```

–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:
```bash
./scripts/prod/deploy.sh 10.20.30.40 ubuntu
```

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫–æ–π —Å–∫—Ä–∏–ø—Ç

| –°–∏—Ç—É–∞—Ü–∏—è | –°–∫—Ä–∏–ø—Ç | –í—Ä–µ–º—è |
|----------|--------|-------|
| –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π | `deploy.sh` | ~10 –º–∏–Ω |
| –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥ –≤ backend/ | `update-backend.sh` | ~2 –º–∏–Ω |
| –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥ –≤ frontend/ | `update-frontend.sh` | ~2 –º–∏–Ω |
| –ò–∑–º–µ–Ω–∏–ª–∏ –∏ backend –∏ frontend | `update-all.sh` | ~5 –º–∏–Ω |
| –ò–∑–º–µ–Ω–∏–ª–∏ nginx –∫–æ–Ω—Ñ–∏–≥ | `update-all.sh` | ~5 –º–∏–Ω |
| –ß—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | `diagnose.sh` | ~2 –º–∏–Ω |
| –û–±–Ω–æ–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | `deploy.sh` | ~10 –º–∏–Ω |

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –û–±—ã—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# 1. –ò–∑–º–µ–Ω–∏–ª–∏ —Ç–æ–ª—å–∫–æ backend –∫–æ–¥
./scripts/prod/update-backend.sh

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://46.21.244.23/health
```

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–∫—Å

```bash
# 1. –ë—ã—Å—Ç—Ä–æ —Ñ–∏–∫—Å–∏–º backend
./scripts/prod/update-backend.sh

# 2. –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
ssh yc-user@46.21.244.23 'cd ~/medhistory && ./scripts/utils/logs.sh backend -f'
```

### –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

```bash
# 1. –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
ssh yc-user@46.21.244.23 'cd ~/medhistory && ./scripts/utils/backup.sh ~/backups'

# 2. –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./scripts/prod/update-all.sh

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º
curl http://46.21.244.23/docs
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
./scripts/prod/diagnose.sh

# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –∫–ª—é—á–∏** (–Ω–µ –ø–∞—Ä–æ–ª–∏)
2. **.env.production –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è** –≤ git
3. **–ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
4. **–õ–æ–≥–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è** (max 10MB, 3 —Ñ–∞–π–ª–∞)

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–∫—Ä–∏–ø—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH
ssh yc-user@46.21.244.23 'echo OK'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
cat scripts/config.sh | grep PROD_SERVER
```

### Health check –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
# 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./scripts/prod/diagnose.sh

# 2. –õ–æ–≥–∏ backend
ssh yc-user@46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs backend --tail=100'

# 3. –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
ssh yc-user@46.21.244.23
cd ~
mv medhistory medhistory_broken
mv medhistory_old_YYYYMMDD_HHMMSS medhistory
cd medhistory
docker compose -f docker-compose.prod.yml up -d
```

### Rsync –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ rsync —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
which rsync

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–Ω–∞ Mac –æ–±—ã—á–Ω–æ –µ—Å—Ç—å)
brew install rsync
```

---

## üìö –°–º. —Ç–∞–∫–∂–µ

- [../README.md](../README.md) - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
- [../utils/README.md](../utils/README.md) - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
- [../../docs/change_log/DEPLOYMENT_SUCCESS_20251028.md](../../docs/change_log/DEPLOYMENT_SUCCESS_20251028.md) - –ò—Å—Ç–æ—Ä–∏—è –¥–µ–ø–ª–æ—è

