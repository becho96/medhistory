# Описание фичи AI-анализа результатов анализа
## AI-интерпретация результатов анализов

---

## 1. Обзор 

### 1.1 Цель
Реализовать функциональность AI-интерпретации медицинских анализов, позволяющую пользователям получать предварительную оценку результатов без необходимости немедленного обращения к врачу.

### 1.2 Проблема
В настоящее время пользователи должны записываться к врачу для интерпретации результатов анализов, даже если показатели находятся в норме. Это приводит к излишним тратам времени и денег, а также увеличивает нагрузку на медицинскую систему.

### 1.3 Решение
AI-ассистент будет анализировать выбранные пользователем результаты анализов (в том числе из нескольких документов) и предоставлять интерпретацию с учетом динамики изменений показателей во времени.

---

## 3. Функциональные требования

### 3.1 Выбор документов для интерпретации

**3.1.1 Множественный выбор документов**
- Пользователь может выбрать один или несколько документов на таймлайне
- Выбор осуществляется через режим множественного выбора который активируется при нажатии кнопки "интерпретировать анализы"
- Визуальная индикация выбранных документов (использовать текущую)
- Счетчик выбранных документов

**3.1.2 Фильтрация перед выбором**
- Сохранение текущей функциональности фильтрации:
  - По типу документа
  - По специальности врача
  - По дате загрузки
  - По дате приема
- Возможность выбирать только из отфильтрованных результатов

**3.1.3 Отправка на интерпретацию**
- Кнопка/опция "Отправить на интерпретацию" появляется после выбора документов
- Всплывающее окно с подтверждением:
  - Список выбранных документов с датами
  - Дисклеймер об ограничениях AI-диагностики
  - Кнопки "Отправить" / "Отменить"

### 3.2 Обработка запроса

**3.2.1 Передача данных в AI-ассистент**
- Отправка всех извлеченных результатов анализов из выбранных документов
- Передача метаданных: дата каждого анализа, тип документа, источник
- Хронологическая сортировка данных для анализа динамики

**3.2.2 Индикация процесса**
- Loader/spinner во время обработки
- Примерное время ожидания
- Возможность отменить запрос (опционально)

### 3.3 AI-интерпретация

**3.3.1 Требования к ответу AI-ассистента**

**Тональность и стиль:**
- Осторожные, не категоричные формулировки
- Избегание медицинских диагнозов
- Понятный для пациента язык
- Эмпатичный тон

**Структура ответа:**
- Общая оценка состояния (норма/требует внимания/требует обращения к врачу)
- Разбор по категориям показателей
- Выявленные отклонения с указанием степени отклонения
- Анализ динамики (при наличии нескольких анализов во времени)
- Рекомендации (общие, без назначения лечения)
- Настоятельная рекомендация обратиться к врачу при обнаружении подозрительных показателей

**Случаи обязательной рекомендации обращения к специалисту:**
- Критические отклонения показателей
- Негативная динамика показателей
- Неоднозначные результаты
- Показатели, требующие дополнительного обследования

**Успокаивающая коммуникация:**
- Если показатели в норме — явное указание на это
- Снижение необоснованной тревожности пациента

**3.3.2 Дисклеймеры**
- Видимое предупреждение о том, что AI не заменяет консультацию врача
- Указание на то, что интерпретация носит информационный характер
- Рекомендация обсудить результаты с лечащим врачом

### 3.4 Новая вкладка "Интерпретации"

**3.4.1 Структура вкладки**
- Новая вкладка в навигации на одном уровне с "Документы"
- Список всех созданных интерпретаций

**3.4.2 Карточка интерпретации**

**Отображаемая информация:**
- Дата создания интерпретации
- Статус (обрабатывается/готово/ошибка)
- Список документов, включенных в анализ:
  - Название документа
  - Дата документа
  - Ссылка на карточку документа
- Текст интерпретации от AI-ассистента
- Визуальное разделение разделов интерпретации

**Функциональность:**
- Возможность открыть полную интерпретацию
- Переход к связанным документам по клику
- Возможность удалить интерпретацию
- Возможность поделиться интерпретацией (опционально)
- Возможность экспорта в PDF (опционально)

**3.4.3 Сортировка и фильтрация**
- По дате создания
- По статусу
- Поиск по содержимому интерпретации

### 3.5 Прозрачность и история

**3.5.1 Трекинг запросов**
- История всех отправленных на интерпретацию наборов документов
- Невозможность дублирования идентичных запросов (предупреждение)
- Предложение открыть существующую интерпретацию при попытке повторной отправки


---

## 4. Нефункциональные требования

### 4.1 Производительность
- Время обработки запроса: не более 30-60 секунд
- Поддержка одновременной обработки нескольких запросов от разных пользователей

### 4.2 Безопасность и конфиденциальность
- Шифрование медицинских данных при передаче в AI-ассистент
- Хранение интерпретаций с тем же уровнем безопасности, что и документы
- Аудит-лог всех запросов на интерпретацию

### 4.3 Надежность
- Обработка ошибок при недоступности AI-ассистента
- Повторная попытка отправки при временных сбоях
- Сохранение запроса в очередь при недоступности сервиса

### 4.4 Масштабируемость
- Архитектура должна поддерживать рост количества пользователей
- Возможность параллельной обработки запросов