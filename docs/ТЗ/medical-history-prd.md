# MedHistory - Product Requirements Document

## Executive Summary

**MedHistory** — это персональная система управления медицинской историей, которая решает критическую проблему фрагментированности медицинских данных. Сервис автоматически каталогизирует, структурирует и визуализирует всю медицинскую документацию пациента, позволяя врачам быстро получать полный контекст для принятия более точных клинических решений.

**Ключевая ценность:** Сокращение времени на сбор анамнеза с 15-20 минут до 2-3 минут, повышение точности диагностики за счет полного доступа к медицинской истории.

---

## Проблема

### Текущая ситуация
Пациенты сталкиваются с фрагментацией медицинских данных:
- Документы хранятся в разных медицинских сервисах
- Часть данных в электронном виде, часть — рукописная
- При смене врача теряется контекст предыдущего лечения
- Сбор истории болезни занимает значительное время на приеме
- Врачи не имеют возможности быстро оценить полную картину

### Последствия
- **Для пациентов:** повторные анализы, неэффективное лечение, потеря времени
- **Для врачей:** ограниченное время приема, неполная информация, риск ошибок
- **Для системы здравоохранения:** повышенные расходы, дублирование процедур

---

## Целевая аудитория

### Primary Persona: "Активный пациент"
- Возраст: 30-55 лет
- Имеет хронические заболевания или регулярно посещает врачей
- Технически грамотен, использует цифровые сервисы
- Заботится о качестве медицинского обслуживания
- Готов инвестировать время в организацию своих медицинских данных

### Secondary Persona: "Заботливый родитель"
- Управляет медицинской документацией семьи
- Нуждается в быстром доступе к детским медицинским картам
- Хочет отслеживать вакцинацию, развитие ребенка

---

## Решение

### Концепция продукта
Веб-приложение с облачным хранением, которое:
1. Автоматически анализирует загруженные медицинские документы
2. Извлекает ключевые метаданные через AI
3. Классифицирует документы по типам и специализациям
4. Визуализирует медицинскую историю на интерактивном timeline
5. Генерирует контекстные отчеты для врачей

### Уникальное конкурентное преимущество
- **AI-автоматизация:** нет необходимости вручную заполнять метаданные
- **Мультиформатность:** работа с PDF, фото, DOCX, рукописными заметками
- **Контекстная визуализация:** интерактивный timeline по специализациям
- **Врачебные отчеты:** автоматическая генерация резюме для новых врачей

---

## Функциональные требования

### MVP (Минимально жизнеспособный продукт)

#### 1. Загрузка и хранение документов
**Возможности:**
- Drag-and-drop загрузка файлов (PDF, JPG, PNG, DOCX)
- Максимальный размер файла: 20 МБ
- Хранение оригиналов в объектном хранилище
- Удаление документов с полной очисткой данных

**Поддерживаемые форматы:**
- PDF документы (выписки, результаты)
- Изображения (фото рукописных заметок, анализов)
- DOCX файлы (электронные документы)

#### 2. AI-анализ документов
**Автоматическое извлечение метаданных:**
- **Тип документа:** прием врача, анализ крови, анализ мочи, УЗИ, МРТ, рентген, выписка из больницы, рецепт
- **Специализация врача:** терапевт, гастроэнтеролог, кардиолог, невролог и т.д. (динамическое обучение)
- **Дата документа:** автоматическое определение даты процедуры/приема
- **ФИО пациента:** извлечение и валидация
- **Медицинское учреждение:** название клиники/лаборатории

**Технология:**
- Vision Language Model (VLM) через OpenRouter (Claude)
- Мультиязычная обработка (русский, английский, другие)
- Поддержка рукописного текста

#### 3. Классификация и метаданные
**Иерархия классификации:**
```
Типы документов
├── Приемы врачей
│   └── [Специализация]
├── Анализы
│   ├── Анализ крови
│   ├── Анализ мочи
│   ├── Биохимический анализ
│   └── Другие
├── Исследования
│   ├── УЗИ
│   ├── МРТ
│   ├── КТ
│   ├── Рентген
│   └── Эндоскопия
├── Выписки
└── Рецепты/Назначения
```

**Динамическая классификация:**
- Система обучается на загруженных документах
- Автоматическое создание новых категорий при необходимости
- Возможность ручного добавления тегов

#### 4. База данных и хранение
**Архитектура данных:**
- PostgreSQL для структурированных метаданных
- MongoDB для гибкого хранения динамических параметров
- MinIO для объектного хранения файлов

**Структура записи:**
```json
{
  "document_id": "uuid",
  "file_url": "minio://bucket/path",
  "created_at": "timestamp",
  "metadata": {
    "document_type": "анализ крови",
    "specialty": "гематолог",
    "date": "2024-03-15",
    "patient_name": "Иванов И.И.",
    "medical_facility": "Клиника Здоровье",
    "tags": ["общий анализ", "контроль"],
    "language": "ru"
  },
  "extracted_data": {
    // Гибкая структура для будущего расширения
  }
}
```

#### 5. Интерактивный Timeline
**Визуализация:**
- Горизонтальная временная шкала с масштабированием
- Иконки для разных типов документов
- Группировка по датам/периодам
- Цветовое кодирование по специализациям

**Фильтрация:**
- По типу документа
- По специализации врача
- По медицинскому учреждению
- По датам (период)
- По тегам

**Интерактивность:**
- Клик на событие → просмотр метаданных
- Hover → краткая информация
- Прямая ссылка на оригинальный документ
- Zoom in/out по временной шкале

#### 6. Генерация врачебных отчетов
**Функционал:**
- Выбор специализации/фильтра
- Автоматическая генерация PDF отчета
- Хронологическое описание событий
- Цитаты из ключевых документов
- Резюме текущего состояния

**Структура отчета:**
1. Общая информация о пациенте
2. Хронология обращений по специализации
3. Ключевые результаты анализов/исследований
4. Назначенное лечение и его динамика
5. Рекомендации и выводы

---

## User Stories

### US-1: Загрузка документа
**Как** пациент  
**Я хочу** загрузить фото рукописной выписки врача  
**Чтобы** система автоматически распознала и сохранила документ

**Критерии приемки:**
- Поддержка drag-and-drop
- Предпросмотр перед загрузкой
- Прогресс-бар загрузки
- Автоматический анализ после загрузки
- Уведомление об успешной обработке

### US-2: Просмотр истории болезни
**Как** пациент  
**Я хочу** увидеть все мои приемы у гастроэнтеролога на timeline  
**Чтобы** понять периодичность обращений и динамику лечения

**Критерии приемки:**
- Фильтр по специализации "Гастроэнтеролог"
- Отображение всех релевантных документов
- Клик на событие открывает детали
- Возможность открыть оригинал документа

### US-3: Подготовка к приему врача
**Как** пациент, идущий к новому кардиологу  
**Я хочу** сгенерировать отчет по всей кардиологической истории  
**Чтобы** передать врачу полный контекст за 1-2 минуты

**Критерии приемки:**
- Фильтр по кардиологии
- Кнопка "Создать отчет для врача"
- Генерация PDF за 10-15 секунд
- Скачивание/печать отчета

### US-4: Удаление неактуального документа
**Как** пользователь  
**Я хочу** удалить ошибочно загруженный документ  
**Чтобы** очистить систему от лишних данных

**Критерии приемки:**
- Кнопка удаления у каждого документа
- Подтверждение удаления
- Полное удаление файла и метаданных
- Обновление timeline

---

## Нефункциональные требования

### Производительность
- Загрузка файла до 20 МБ за < 10 секунд
- Анализ документа через LLM за < 30 секунд
- Отображение timeline с 500+ документами за < 2 секунды
- Генерация PDF отчета за < 15 секунд

### Безопасность
- Базовая аутентификация (логин/пароль)
- HTTPS для всех соединений
- Шифрование паролей (bcrypt/argon2)
- Валидация всех входных данных
- Ограничение размера файлов

### Доступность
- Адаптивный дизайн для мобильных устройств
- Поддержка основных браузеров (Chrome, Firefox, Safari, Edge)
- Минимальное разрешение: 320px (мобильные)

### Масштабируемость
- Архитектура готова к добавлению новых типов извлекаемых данных
- Гибкая схема БД для будущих параметров
- Модульная структура для добавления новых функций

---

## Дорожная карта (Roadmap)

### Phase 1: MVP (2-3 месяца)
✅ Базовая загрузка документов  
✅ AI-анализ и классификация  
✅ Timeline визуализация  
✅ Генерация PDF отчетов  
✅ Ручные теги

### Phase 2: Расширение (3-4 месяца)
- Извлечение структурированных данных из анализов
- Графики динамики показателей (гемоглобин, холестерин и т.д.)
- Полнотекстовый поиск по документам
- Автоматическое связывание связанных документов

### Phase 3: Интеллектуальные функции (4-6 месяцев)
- AI-инсайты (выявление противоречий, паттернов)
- Рекомендации по дополнительным обследованиям
- Интеграция с медицинскими сервисами (импорт)
- Семейные аккаунты

### Phase 4: Масштабирование (6-12 месяцев)
- API для сторонних приложений
- Интеграция с электронными медицинскими картами
- Экспорт в стандартизированных форматах (HL7, FHIR)
- Marketplace для врачебных интеграций

---

## Метрики успеха

### Product Metrics
- **Retention Rate:** % пользователей, возвращающихся через месяц (цель: >60%)
- **Engagement:** среднее количество загруженных документов на пользователя (цель: >20)
- **Report Generation:** % пользователей, генерирующих отчеты (цель: >40%)
- **Time to Value:** время от регистрации до первого полезного действия (цель: <15 мин)

### Business Metrics
- **CAC (Customer Acquisition Cost):** стоимость привлечения пользователя
- **LTV (Lifetime Value):** пожизненная ценность пользователя
- **Conversion Rate:** % посетителей → зарегистрированных пользователей

### Technical Metrics
- **Uptime:** доступность системы (цель: 99.5%)
- **Processing Accuracy:** точность извлечения метаданных (цель: >90%)
- **API Response Time:** медиана времени ответа (цель: <500ms)

---

## Риски и митигации

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Высокая стоимость LLM API | Высокая | Высокое | Использование кеширования, оптимизация промптов, тестирование на малой выборке |
| Низкая точность распознавания рукописного текста | Средняя | Среднее | Использование топовых VLM моделей, возможность ручной корректировки |
| Конкуренция с крупными платформами | Средняя | Высокое | Фокус на персонализации и приватности, быстрый выход на рынок |
| Проблемы с приватностью данных | Низкая | Критическое | Строгое соблюдение законов о медицинских данных, прозрачность |
| Медленное внедрение пользователями | Средняя | Высокое | Простой onboarding, демо-примеры, образовательный контент |

---

## Monetization Strategy (Будущее)

### Freemium Model
- **Free tier:** до 50 документов, базовая функциональность
- **Pro tier ($9.99/месяц):** неограниченные документы, продвинутая аналитика
- **Family tier ($19.99/месяц):** до 5 пользователей

### Alternative Revenue Streams
- B2B продажи клиникам (корпоративные лицензии)
- API access для медицинских платформ
- Анонимизированные данные для исследований (с согласия)

---

## Вывод

MedHistory решает критическую проблему фрагментации медицинских данных, предоставляя пациентам и врачам единое окно в полную медицинскую историю. Используя передовые AI-технологии, продукт автоматизирует трудоемкий процесс каталогизации и делает медицинскую информацию доступной в нужный момент.

**Следующие шаги:**
1. Разработка технической архитектуры
2. Создание прототипа UI/UX
3. Разработка MVP
4. Тестирование на фокус-группе из 10-20 пользователей
5. Итерация на основе обратной связи