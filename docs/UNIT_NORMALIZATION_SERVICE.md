# –°–µ—Ä–≤–∏—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è

## üìã –û–±–∑–æ—Ä

–°–µ—Ä–≤–∏—Å `UnitNormalizationService` —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤, –≤–æ–∑–Ω–∏–∫–∞—é—â—É—é –∏–∑-–∑–∞:

- –†–∞–∑–ª–∏—á–∏–π –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ (—Ç–æ—á–∫–∏ –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–æ–±–µ–ª—ã)
- –†–∞–∑–Ω—ã—Ö –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –µ–¥–∏–Ω–∏—Ü—ã (`–º–º/—á` vs `–º–º/—á–∞—Å`)
- –í–∞—Ä–∏–∞—Ü–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ (`10*9/–ª` vs `—Ö10^9/–ª`)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è** - –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫ –µ–¥–∏–Ω–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É
2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –µ–¥–∏–Ω–∏—Ü** - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
3. **–ë–∞–∑–∞ –¥–ª—è –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏** - –æ—Å–Ω–æ–≤–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ "—Å—ã—Ä—ã—Ö" —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–æ–≤

## üìÅ –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

**–§–∞–π–ª:** `backend/app/services/unit_normalization_service.py`

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from app.services.unit_normalization_service import unit_normalization_service

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã
normalized = unit_normalization_service.normalize_unit("–ø/–∑—Ä.")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ø/–∑—Ä"

normalized = unit_normalization_service.normalize_unit("10*9/–ª")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "√ó10‚Åπ/–ª"

normalized = unit_normalization_service.normalize_unit("–º–º/—á")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–º–º/—á–∞—Å"
```

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞

```python
lab_result = {
    "test_name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã",
    "value": "5.2",
    "unit": "–ø/–∑—Ä.",  # –ò—Å—Ö–æ–¥–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Å —Ç–æ—á–∫–æ–π
    "reference_range": "0-3",
    "flag": "N"
}

normalized_result = unit_normalization_service.normalize_lab_result(lab_result)
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#     "test_name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã",
#     "value": "5.2",
#     "unit": "–ø/–∑—Ä",  # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞
#     "original_unit": "–ø/–∑—Ä.",  # –û—Ä–∏–≥–∏–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω
#     "reference_range": "0-3",
#     "flag": "N"
# }
```

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
lab_results = [
    {"test_name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã", "value": "5.2", "unit": "–ø/–∑—Ä.", ...},
    {"test_name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã", "value": "5.0", "unit": "–ø/–∑—Ä", ...},
]

normalized_results = unit_normalization_service.normalize_lab_results(lab_results)
# –û–±–µ –µ–¥–∏–Ω–∏—Ü—ã –±—É–¥—É—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫ "–ø/–∑—Ä"
```

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –µ–¥–∏–Ω–∏—Ü

```python
units = ["–ø/–∑—Ä.", "–ø/–∑—Ä", "–º–º/—á", "–º–º/—á–∞—Å", "10*9/–ª", "—Ö10^9/–ª"]

groups = unit_normalization_service.get_unit_groups(units)
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#     "–ø/–∑—Ä": ["–ø/–∑—Ä.", "–ø/–∑—Ä"],
#     "–º–º/—á–∞—Å": ["–º–º/—á", "–º–º/—á–∞—Å"],
#     "√ó10‚Åπ/–ª": ["10*9/–ª", "—Ö10^9/–ª"]
# }
```

## üîÑ –¢–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

### –ú–∞–ø–ø–∏–Ω–≥ –µ–¥–∏–Ω–∏—Ü

| –ò—Å—Ö–æ–¥–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ |
|-----------------|------------------------|
| `–ø/–∑—Ä.` | `–ø/–∑—Ä` |
| `–ø/–∑—Ä` | `–ø/–∑—Ä` |
| `–º–º/—á` | `–º–º/—á–∞—Å` |
| `–º–º/—á–∞—Å` | `–º–º/—á–∞—Å` |
| `10*9/–ª` | `√ó10‚Åπ/–ª` |
| `—Ö10^9/–ª` | `√ó10‚Åπ/–ª` |
| `10^9/–ª` | `√ó10‚Åπ/–ª` |
| `10*12/–ª` | `√ó10¬π¬≤/–ª` |
| `—Ö10^12/–ª` | `√ó10¬π¬≤/–ª` |
| `–µ–¥. pH` | `pH` |
| `pH` | `pH` |

### Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –≤ –∫–æ–Ω—Ü–µ:** `"–ø/–∑—Ä."` ‚Üí `"–ø/–∑—Ä"`
2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤:** `"–≥/ –¥–ª"` ‚Üí `"–≥/–¥–ª"`
3. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–µ–ø–µ–Ω–∏:** `"10*9/–ª"` ‚Üí `"√ó10‚Åπ/–ª"`

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ API

### –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/documents/labs/analytes`

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è:

```python
# –î–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
{
    "name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã",
    "units": [
        {"unit": "–ø/–∑—Ä.", "count": 14},
        {"unit": "–ø/–∑—Ä", "count": 11}
    ]
}

# –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
{
    "name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã",
    "units": [
        {
            "unit": "–ø/–∑—Ä",  # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞
            "count": 25,  # –°—É–º–º–∞ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
            "original_units": ["–ø/–∑—Ä.", "–ø/–∑—Ä"]  # –°–ø–∏—Å–æ–∫ –∏—Å—Ö–æ–¥–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        }
    ]
}
```

### –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/documents/labs/timeseries`

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö:

```python
# –ó–∞–ø—Ä–æ—Å —Å –µ–¥–∏–Ω–∏—Ü–µ–π "–ø/–∑—Ä." –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –∑–∞–ø–∏—Å–∏ —Å "–ø/–∑—Ä" –∏ "–ø/–∑—Ä."
GET /api/v1/documents/labs/timeseries?analyte=–õ–µ–π–∫–æ—Ü–∏—Ç—ã&unit=–ø/–∑—Ä.

# –í –æ—Ç–≤–µ—Ç–µ –≤—Å–µ –µ–¥–∏–Ω–∏—Ü—ã –±—É–¥—É—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
{
    "analyte": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã",
    "points": [
        {
            "unit": "–ø/–∑—Ä",  # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è
            "original_unit": "–ø/–∑—Ä.",  # –û—Ä–∏–≥–∏–Ω–∞–ª (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
            ...
        }
    ]
}
```

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –º–∞–ø–ø–∏–Ω–≥–∞

```python
# –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ
unit_normalization_service.add_unit_mapping("–º–≥/–¥–ª", "–º–≥/–ª")
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞

```python
stats = unit_normalization_service.get_mapping_stats()
# {
#     "total_mappings": 15,
#     "normalized_units": 10,
#     "mappings_by_normalized": {...},
#     "regex_patterns": 3
# }
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è**
   - `–≥/–¥–ª` ‚Üí `–≥/–ª` (—Å —É–º–Ω–æ–∂–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 10)
   - `–Ω–≥/–º–ª` ‚Üí `–º–∫–≥/–ª` (—Å —É–º–Ω–æ–∂–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 1)

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö

3. **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
   - –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

4. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
   - –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è
   - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã

–ò–∑ –∞–Ω–∞–ª–∏–∑–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (375 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–æ–≤):

1. **`–ø/–∑—Ä.` –∏ `–ø/–∑—Ä`** - 25 –∑–∞–ø–∏—Å–µ–π
   - –ù–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∫: `–ø/–∑—Ä`

2. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã** (–µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è):
   - `–º–º/—á` –∏ `–º–º/—á–∞—Å`
   - `10*9/–ª` –∏ `—Ö10^9/–ª`
   - `–µ–¥. pH` –∏ `pH`

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `backend/app/services/unit_normalization_service.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
- `backend/app/api/v1/endpoints/documents.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API
- `backend/scripts/analyze_all_units.py` - —Å–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –µ–¥–∏–Ω–∏—Ü
- `docs/LAB_UNITS_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–æ–ª–µ `original_unit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è "–Ω–∞ –ª–µ—Ç—É" –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö
- –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è:** 1.0

