# üéâ –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ MedHistory

**–î–∞—Ç–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–°–µ—Ä–≤–µ—Ä:** –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ

---

## üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **IP –∞–¥—Ä–µ—Å** | `46.21.244.23` |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** | `yc-user` |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | 4 vCPU, 8 GB RAM, 50 GB SSD |
| **–û–°** | Ubuntu 22.04 LTS |
| **–ó–æ–Ω–∞** | ru-central1-a |

---

## üîó –î–æ—Å—Ç—É–ø–Ω—ã–µ URL

- **Frontend:** http://46.21.244.23
- **API Docs:** http://46.21.244.23/docs
- **Health Check:** http://46.21.244.23/health

---

## ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **NGINX** - Reverse Proxy (–ø–æ—Ä—Ç—ã 80, 443)
2. **Frontend** - React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **Backend** - FastAPI —Å–µ—Ä–≤–µ—Ä
4. **PostgreSQL** - –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
5. **MongoDB** - NoSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
6. **MinIO** - –û–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Docker Compose.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –ø–∞—Ä–æ–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ JWT —Å–µ–∫—Ä–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ OpenRouter API –∫–ª—é—á –ø–æ–¥–∫–ª—é—á–µ–Ω  
- ‚úÖ Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (SSH: 22, HTTP: 80, HTTPS: 443)

---

## üì¶ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 MSK
- **–°–∫—Ä–∏–ø—Ç:** `~/medhistory/scripts/backup.sh`
- **–ü–∞–ø–∫–∞ –±—ç–∫–∞–ø–æ–≤:** `~/backups`
- **–õ–æ–≥ —Ñ–∞–π–ª:** `~/backups/backup.log`

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø

```bash
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && ./scripts/backup.sh ~/backups'
```

---

## üìã –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh -l yc-user 46.21.244.23
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
ssh -l yc-user 46.21.244.23 'docker ps'

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs -f'

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ backend
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs -f backend'

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ frontend
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs -f frontend'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml restart'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml restart backend'

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml down'

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml up -d'
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh -l yc-user 46.21.244.23 'docker stats'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
ssh -l yc-user 46.21.244.23 'df -h'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
ssh -l yc-user 46.21.244.23 'free -h'

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã
ssh -l yc-user 46.21.244.23 'uptime'
```

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ú–µ—Ç–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ deploy.sh

```bash
cd "/Users/boris/Desktop/–ù–∞—á–∞–ª–æ/–ò—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–∏"
./scripts/deploy.sh 46.21.244.23 yc-user
```

### –ú–µ—Ç–æ–¥ 2: –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
cd "/Users/boris/Desktop/–ù–∞—á–∞–ª–æ/–ò—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–∏"
tar --exclude='node_modules' --exclude='__pycache__' --exclude='frontend/dist' --exclude='.git' -czf /tmp/update.tar.gz .

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp /tmp/update.tar.gz yc-user@46.21.244.23:~/

# 3. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml down && cd ~ && tar -xzf update.tar.gz -C medhistory && cd ~/medhistory && docker compose -f docker-compose.prod.yml build --no-cache && docker compose -f docker-compose.prod.yml up -d'
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://46.21.244.23
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ HTTPS:

```bash
# 1. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –∫ IP 46.21.244.23 (—á–µ—Ä–µ–∑ DNS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)

# 2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -l yc-user 46.21.244.23

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ certbot
sudo apt install certbot python3-certbot-nginx -y

# 4. –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --standalone -d your-domain.com

# 5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ~/medhistory/nginx/ssl/
sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem ~/medhistory/nginx/ssl/
sudo chown yc-user:yc-user ~/medhistory/nginx/ssl/*

# 6. –û–±–Ω–æ–≤–∏—Ç–µ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ HTTPS –±–ª–æ–∫)
nano ~/medhistory/nginx/nginx.conf

# 7. –û–±–Ω–æ–≤–∏—Ç–µ .env.production –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
# VITE_API_URL=https://your-domain.com

# 8. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
cd ~/medhistory
docker compose -f docker-compose.prod.yml down
docker compose -f docker-compose.prod.yml build --no-cache frontend
docker compose -f docker-compose.prod.yml up -d
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –û—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
- –í—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs'

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
ssh -l yc-user 46.21.244.23 'docker ps -a'
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint
curl http://46.21.244.23/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs nginx'
```

### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

```bash
# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö Docker –æ–±—Ä–∞–∑–æ–≤
ssh -l yc-user 46.21.244.23 'docker system prune -a'

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
ssh -l yc-user 46.21.244.23 'find ~/backups -name "*.tar.gz" -mtime +30 -delete'
```

### Backend –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PostgreSQL
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml restart postgres'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ PostgreSQL
ssh -l yc-user 46.21.244.23 'cd ~/medhistory && docker compose -f docker-compose.prod.yml logs postgres'
```

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

| –°–µ—Ä–≤–∏—Å | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å |
|--------|---------------|
| –í–ú –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ (4 vCPU, 8 GB) | ~2,500‚ÇΩ |
| –î–∏—Å–∫ SSD 50 GB | ~500‚ÇΩ |
| –í–Ω–µ—à–Ω–∏–π IP | ~150‚ÇΩ |
| –¢—Ä–∞—Ñ–∏–∫ | ~200‚ÇΩ |
| OpenRouter API | ~500‚ÇΩ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) |
| **–ò–¢–û–ì–û** | **~3,850‚ÇΩ/–º–µ—Å** |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤

1. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–ú –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è** - —ç–∫–æ–Ω–æ–º–∏—è ~60%
2. **–°–Ω–∏–∂–µ–Ω–∏–µ core-fraction –¥–æ 50%** - —ç–∫–æ–Ω–æ–º–∏—è ~50%
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ snapshot –≤–º–µ—Å—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –í–ú** - –¥–ª—è dev/test –æ–∫—Ä—É–∂–µ–Ω–∏–π

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** `/docs` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- **–õ–æ–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** –≠—Ç–æ—Ç —Ñ–∞–π–ª
- **Yandex Cloud Console:** https://console.cloud.yandex.ru

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [x] –í–ú —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø—É—â–µ–Ω–∞
- [x] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [x] –ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [x] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
- [x] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Frontend –¥–æ—Å—Ç—É–ø–µ–Ω
- [x] API Docs –¥–æ—Å—Ç—É–ø–Ω—ã
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

---

**–£—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MedHistory! üöÄ**
