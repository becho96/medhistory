# Реализация модального окна для отображения деталей документа

**Дата:** 28 октября 2025  
**Статус:** ✅ Завершено

## Проблема

При клике на элемент документа в списке документов на странице "Медкарта" не открывалось модальное окно с деталями документа. Обработчик `onClick` был настроен и устанавливал `selectedDocumentId`, но компонент модального окна отсутствовал.

## Решение

### 1. Создан новый компонент `DocumentModal`

**Файл:** `frontend/src/components/Documents/DocumentModal.tsx`

Компонент отображает полную информацию о документе:
- Название файла и тип документа
- Дата документа и дата загрузки
- Информация о пациенте (если указана)
- Медицинское учреждение
- Специализация врача
- Статус обработки документа
- Размер файла
- Извлеченные результаты анализов (для типа "Результаты анализа")

**Функциональность:**
- Загрузка данных документа через API (`documentsService.getDocument`)
- Кнопки действий:
  - **Открыть** - открывает документ в новой вкладке
  - **Скачать** - скачивает файл документа
  - **Удалить** - удаляет документ с подтверждением
  - **Закрыть** - закрывает модальное окно
- Для документов типа "Результаты анализа" отображается таблица с извлеченными анализами
- Закрытие по клику вне модального окна или по клавише Escape
- Адаптивный дизайн для мобильных устройств

### 2. Интеграция в страницу Documents

**Файл:** `frontend/src/pages/Documents.tsx`

Добавлен импорт и использование компонента:
```typescript
import DocumentModal from '../components/Documents/DocumentModal'

// В конце компонента:
<DocumentModal
  documentId={selectedDocumentId}
  onClose={() => setSelectedDocumentId(null)}
/>
```

### 3. Существующие обработчики

Обработчики клика на документ уже были реализованы:
- В списке документов (строка 725): `onClick={() => setSelectedDocumentId(doc.id)}`
- На кнопке "Показать детали" (строка 817): `onClick={() => setSelectedDocumentId(doc.id)}`
- В timeline view (строка 459): `setSelectedDocumentId(docId)`

## Технические детали

### Используемые библиотеки и хуки
- `@tanstack/react-query` - для загрузки данных и мутаций
- `lucide-react` - иконки
- `date-fns` - форматирование дат
- `sonner` - уведомления (toast)

### Особенности реализации
1. **Избегание конфликта имен**: Переменная с данными документа названа `doc`, чтобы избежать конфликта с глобальным объектом `document` в DOM
2. **Автоматическое отображение анализов**: Если документ имеет тип "Результаты анализа", таблица с анализами отображается автоматически
3. **Инвалидация кеша**: После удаления документа инвалидируются все связанные query keys для обновления списков

## Преимущества

1. **Полная информация о документе** в одном месте
2. **Удобные действия** с документом (открыть, скачать, удалить)
3. **Интеграция с существующим компонентом** `LabResultsTable` для отображения анализов
4. **Адаптивный дизайн** для всех устройств
5. **Хорошая UX**: закрытие по Escape, клику вне модального окна

## Тестирование

Для проверки работы:
1. Перейти на страницу "Медкарта"
2. Кликнуть на любой документ в списке
3. Должно открыться модальное окно с деталями документа
4. Проверить все кнопки действий (открыть, скачать, удалить, закрыть)
5. Для документов типа "Результаты анализа" проверить отображение таблицы с анализами
6. Проверить закрытие по Escape и клику вне окна

## Связанные файлы

- `frontend/src/components/Documents/DocumentModal.tsx` (новый файл)
- `frontend/src/pages/Documents.tsx` (обновлен)
- `frontend/src/services/documents.ts` (без изменений, используется существующий API)

