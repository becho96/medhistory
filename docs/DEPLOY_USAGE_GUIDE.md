# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç–∞ deploy

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–∞–∑ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **Docker volumes**:
- `postgres_data` - PostgreSQL (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- `mongodb_data` - MongoDB (–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ AI)
- `minio_data` - MinIO (–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)

**Volumes —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤!**

### ‚ö†Ô∏è –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã

–î–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏:
1. –Ø–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–ª–∞–≥–∞ `--clean-data`
2. –†—É—á–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `docker compose down -v`
3. –†—É—á–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏ `docker volume rm <volume_name>`

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1Ô∏è‚É£ –û–±—ã—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥ backend –∏–ª–∏ frontend
- –û–±–Ω–æ–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt, package.json)
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker

```bash
# Staging
./deploy staging --rebuild

# Production
./deploy production --rebuild

# Local
./deploy local --rebuild
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ —Å —É—á–µ—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!**

---

### 2Ô∏è‚É£ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ò–∑–º–µ–Ω–∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env —Ñ–∞–π–ª—ã)
- –ò–∑–º–µ–Ω–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ docker-compose —Ñ–∞–π–ª–∞—Ö
- –ù–ï –º–µ–Ω—è–ª–∏ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤
./deploy staging --update

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ
./deploy staging
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ö° –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ (–±—ã—Å—Ç—Ä–µ–µ!)
- ‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!**

**–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏:** ~5 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ ~10 –º–∏–Ω—É—Ç –Ω–∞ staging

---

### 3Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ .env —Ñ–∞–π–ª–æ–≤

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ò–∑–º–µ–Ω–∏–ª–∏ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ò–∑–º–µ–Ω–∏–ª–∏ API –∫–ª—é—á–∏
- –ò–∑–º–µ–Ω–∏–ª–∏ –ø–∞—Ä–æ–ª–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

```bash
# 1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
vim environments/staging.env

# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å
cp environments/staging.env .env.staging

# 3. –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./deploy staging --update
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
- ‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!**
- ‚ö° –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ!)

---

### 4Ô∏è‚É£ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–Ω–æ–≤—ã–π —Å—Ç–∞—Ä—Ç)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î —Å –Ω—É–ª—è
- –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–π –ë–î

```bash
# ‚ö†Ô∏è –£–î–ê–õ–ò–¢ –í–°–ï –î–ê–ù–ù–´–ï!
./deploy staging --clean-data --rebuild
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚ö†Ô∏è –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ "YES")
- üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö volumes —Å –¥–∞–Ω–Ω—ã–º–∏
- üî® –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
- üöÄ –ó–∞–ø—É—Å–∫ —Å –ø—É—Å—Ç—ã–º–∏ –±–∞–∑–∞–º–∏

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!

---

### 5Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –•–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å Grafana/Prometheus
- –ù—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# Staging —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
./deploy staging --monitoring

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
./deploy staging --rebuild --monitoring
```

**–ß—Ç–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:**
- üìä Grafana: http://localhost:3001
- üìà Prometheus: http://localhost:9091
- ‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!**

---

## –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏

### –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø—Ä–∞–≤–∏–ª–∏ CORS (–∫–∞–∫ —Å–µ–≥–æ–¥–Ω—è)

```bash
# 1. –ò–∑–º–µ–Ω–∏–ª–∏ main.py (–¥–æ–±–∞–≤–∏–ª–∏ staging CORS)
vim backend/main.py

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞–ª–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏
./deploy staging --rebuild

# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç, ‚úÖ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–∏–ª–∏ API –∫–ª—é—á OpenRouter

```bash
# 1. –û–±–Ω–æ–≤–∏–ª–∏ .env
vim environments/staging.env
# –ò–∑–º–µ–Ω–∏–ª–∏: OPENROUTER_API_KEY=new_key_here

# 2. –ü—Ä–∏–º–µ–Ω–∏–ª–∏ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
cp environments/staging.env .env.staging
./deploy staging --update

# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ö° –ë—ã—Å—Ç—Ä–æ, ‚úÖ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

### –ü—Ä–∏–º–µ—Ä 3: –û–±–Ω–æ–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

```bash
# 1. –î–æ–±–∞–≤–∏–ª–∏ –≤ requirements.txt –Ω–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
echo "pandas==2.0.0" >> backend/requirements.txt

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞–ª–∏ –æ–±—Ä–∞–∑
./deploy staging --rebuild

# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ù–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞, ‚úÖ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

### –ü—Ä–∏–º–µ—Ä 4: –•–æ—Ç–∏–º –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞

```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ staging
./deploy staging --clean-data --rebuild

# –°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ "YES" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
# –†–µ–∑—É–ª—å—Ç–∞—Ç: üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã, –Ω–æ–≤—ã–π —Å—Ç–∞—Ä—Ç
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ volumes

```bash
docker volume ls | grep staging
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
medhistory-staging_postgres_data
medhistory-staging_mongodb_data
medhistory-staging_minio_data
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã

```bash
# –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
docker exec medhistory-staging-postgres-1 \
  psql -U medhistory_user -d medhistory -c "SELECT COUNT(*) FROM users;"

# –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–Ω–æ–≤–∞
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å!
```

---

## –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì –ù—É–∂–Ω–æ –ª–∏ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º?

**–î–ª—è staging:** –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ
```bash
# –ë—ç–∫–∞–ø –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è production
./scripts/utils/backup.sh
```

**–î–ª—è production:** –ë—ç–∫–∞–ø –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–ø–ª–æ–µ–º

### ‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫?

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker logs medhistory-staging-backend-1 --tail 100

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker ps -a | grep staging

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
./scripts/utils/restore.sh /path/to/backup.tar.gz
```

### ‚ùì –ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é?

```bash
# 1. –û—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git
git reset --hard HEAD~1

# 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
./deploy staging --rebuild

# –î–∞–Ω–Ω—ã–µ –ë–î –æ—Å—Ç–∞–Ω—É—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏!
```

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏?

–ù–µ—Ç, Docker —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏. –ù–æ:
- –í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è: ~10-30 —Å–µ–∫—É–Ω–¥
- –î–ª—è production –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å blue-green deployment

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–í—Å–µ–≥–¥–∞ –∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º**
   ```bash
   git add .
   git commit -m "Update: –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
   ./deploy staging --rebuild
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --rebuild –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞**
   ```bash
   ./deploy staging --rebuild
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --update –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   ```bash
   ./deploy staging --update
   ```

4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ staging –ø–µ—Ä–µ–¥ production**
   ```bash
   ./deploy staging --rebuild    # –¢–µ—Å—Ç
   ./deploy production --rebuild # –î–µ–ø–ª–æ–π
   ```

### ‚ùå –ü–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--clean-data` –Ω–∞ production
2. ‚ùå –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
3. ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –±—ç–∫–∞–ø—ã –Ω–∞ production
4. ‚ùå –î–µ–ø–ª–æ–∏—Ç—å –Ω–∞ production –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ staging

---

## –®–ø–∞—Ä–≥–∞–ª–∫–∞ –∫–æ–º–∞–Ω–¥

```bash
# –û–±—ã—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
./deploy staging --rebuild

# –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
./deploy staging --update

# –° –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
./deploy staging --monitoring

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (‚ö†Ô∏è —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ!)
./deploy staging --clean-data --rebuild

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs medhistory-staging-backend-1 -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ volumes
docker volume ls | grep staging

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è
docker compose -p medhistory-staging \
  -f docker-compose.base.yml \
  -f docker-compose.staging.yml \
  --env-file .env.staging stop
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª volumes

```
–°–æ–∑–¥–∞–Ω–∏–µ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫):
  docker compose up -d
    ‚îî‚îÄ> –°–æ–∑–¥–∞—é—Ç—Å—è volumes: postgres_data, mongodb_data, minio_data

–û–±—ã—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
  docker compose down      ‚Üê –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
  docker compose build     ‚Üê –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã
  docker compose up -d     ‚Üê –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ volumes
    ‚îî‚îÄ> Volumes –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏!

–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
  docker compose down -v   ‚Üê –£–¥–∞–ª—è–µ—Ç volumes (—Ñ–ª–∞–≥ -v)
    ‚îî‚îÄ> –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã!
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢—Ä–µ–±—É–µ—Ç rebuild? | –¢—Ä–µ–±—É–µ—Ç restart? |
|------------|------------------|------------------|
| POSTGRES_PASSWORD | ‚ùå –ù–µ—Ç* | ‚úÖ –î–∞ |
| JWT_SECRET | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| OPENROUTER_API_KEY | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| VITE_API_URL | ‚úÖ –î–∞** | ‚úÖ –î–∞ |

\* –ï—Å–ª–∏ –ë–î —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –ø–∞—Ä–æ–ª—å –≤ volumes –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è  
\*\* Frontend –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π —Å–µ—Å—Å–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** CORS –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ staging

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏–ª–∏ staging origins –≤ `backend/main.py`
2. –ò—Å–ø—Ä–∞–≤–∏–ª–∏ `VITE_API_URL` –≤ `environments/staging.env`
3. –í—ã–ø–æ–ª–Ω–∏–ª–∏: `./deploy staging --rebuild`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, ‚úÖ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!

